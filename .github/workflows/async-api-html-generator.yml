name: AsyncAPI documents processing

on:
  push:
    tags:
      - v2.**

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v2

      - name: Generating HTML from my AsyncAPI document
        uses: docker://asyncapi/github-action-for-generator:2.0.3
        with:
          template: '@asyncapi/html-template@0.24.9'
          filepath: asyncapi.yml
          output: docs

      - name: Modify version in index.html
        run: |
          sudo sed -i 's/0.0.0/${{github.ref_name}}/g' docs/index.html
        shell: bash

      - name: Commit files to master branch
        uses: GuillaumeFalourd/copy-push-files@v1
        with:
          target_branch: master
          target_dir: docs/${{github.ref_name}}
          commit_message: 'Auto-commit from Github Action'
          source_files: docs/index.html docs/js docs/css examples json-schemas
          remote_repository: https://github.com/RuterNo/adt-doc
          access_token: ${{ secrets.GITHUB_TOKEN }}

