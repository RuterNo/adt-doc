{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"adt-api/","title":"ADT API","text":""},{"location":"adt-api/#introduction","title":"Introduction","text":"<p>This document describes the MQTT API in use for communication between PTO and PTA. </p> <p>Versioning</p> <p>The documentation below follows Semantic Versioning 2.0.0</p> Increment Description MAJOR Indicates incompatible API changes. MINOR Indicates addition of functionality in a backwards-compatible manner. PATCH Indicates backwards-compatible bug fixes. (typos etc.) <p>Example: v2.3.1</p> <p>To see additional information in relation to the API specifications, please visit:</p> <ul> <li>https://ruter.atlassian.net</li> </ul>"},{"location":"adt-api/#resources","title":"Resources","text":"<p>MQTT API Documentation</p>"},{"location":"browser-requirements/","title":"Browser requirements","text":"<p>The PTO is required to install and maintain one of the following browsers: </p> Browser name Additional resources Firefox mozilla.org Chrome google.com Chromium chromium.org"},{"location":"browser-requirements/#network","title":"Network","text":"<ul> <li>The browser must have internet access (port 443)</li> </ul>"},{"location":"browser-requirements/#additional-requirements","title":"Additional requirements","text":"<ul> <li>Only stable software versions are to be used. </li> <li>The browser needs to be periodically updated and must never be older than 12 months.</li> <li>The browser must have persistent storage available. </li> <li>All feature flags set to default values, unless otherwise agreed upon with Ruter.</li> </ul>"},{"location":"insight/","title":"SLA Insight","text":""},{"location":"insight/#background","title":"Background","text":"<p>The PTO is the single entity being responsible for monitoring interfaces and equipment on board their own vehicles. The  APIs below should only be viewed as a supplement, and not a replacement of any monitoring solutions by the PTO.</p> <p>To provide some insights into what Ruter AS observes from our part, we have decided to share some insights into our  continuous monitoring systems. By observing these data, the PTOs have an additional tool to help them identify and resolve issues that may disrupt the customer experience on board their vehicle. </p>"},{"location":"insight/#apis","title":"APIs","text":""},{"location":"insight/#display-status-v1","title":"Display status V1","text":""},{"location":"insight/#functional-description","title":"Functional description","text":"<p>This application has been made to assist operators in identifying issues with their equipment. The original data source used here is the same as the one used by Ruter to calculate SLA for DPI displays. However, this API is not intended for calculating SLA breaches.</p> <p>The application reports any change to display statuses as retained messages on MQTT. This way the last know status of the vehicle is available to the operator at any time.</p>"},{"location":"insight/#evaluation","title":"Evaluation","text":"<p>Based on data sent to the vehicle and DPI diagnostic messages received from the vehicle, the following things are checked:</p> <ul> <li>Are any displays running?</li> <li>Are the right number of displays running for the bus type?</li> <li>Are the displays running the right version of the DPI application?</li> <li>Are the displays showing the current route?</li> <li>Do the screens have client-side storage in browser? </li> <li>Is the screen resolution matched to the right display type?</li> </ul> <p>These are determined in the ComplianceCalculator class. It will evaluate all of these and produce the following compliance values:</p> <ul> <li>OK - all tests have passed</li> <li>FAIL - one or more test has failed</li> <li>NOT_IN_SERVICE - the bus is on a dead run, so no compliance is required.</li> <li>UNKNOWN - we don't know what journey the bus should be on so cannot evaluate compliance</li> </ul> <p>FAIL is the only value that implies SLA non-compliance.</p> <p>Along with the overall Compliance value, a list of zero or more ComplianceFault values to explain the result. In addition, metadata is recorded so that the correctness of the Compliance value can be understood. This includes information about the current journey/route, counts of known and seen displays, and a list of displays from which we received heartbeats.</p>"},{"location":"insight/#technical-description","title":"Technical description","text":""},{"location":"insight/#payload-fields","title":"Payload fields","text":"Field Type Description eventTimestamp string. ISO-8601 format / UTC, the evaluation time Compliance enumeration OK / FAIL / UNKNOWN / NOT_IN_SERVICE ComplianceFaults array of string List of faults, if any are detected, regardless of overall compliance. See list of possible strings in a later section JourneyStatus enumeration ON_SERVICE_JOURNEY / ON_DEAD_RUN / UNKNOWN. LatestJourneyId is evaluate to determine this value. TotalDisplayCount integer count of all client IDs that have been recorded since state has been recorded. (State will be reset after 4 hours of inactivity.) ExpectedDisplayCount integer number of expected client IDs / displays for this vehicle. If incorrect, please contact: <code>rdp-support@ruter.no</code> LiveDisplayCount integer count of displays sending heartbeat at evaluation time. These will be listed in the following item. Displays array of Display list of all displays sending heartbeat at evaluation time. See next section for definition of Display."},{"location":"insight/#display","title":"Display","text":"Field Type Description ClientId string UUID generated and persisted on CPU unit running display DisplayId string Current configuration of display RouteId string / null Route id reported by display. Found in local mqtt topic: <code>pe/dpi/journey</code>, field: <code>/route/id</code> DPIVersion string DPI version reported by display MediaVersion string / null Media package version reported by display"},{"location":"insight/#specific-fault-messages","title":"Specific Fault Messages","text":"Code Description DATA_OUT_OF_SYNC all displays have incorrect route DATA_PARTLY_IN_SYNC some displays have incorrect route NO_LIVE_DISPLAYS n live = 0 DISPLAYS_MISSING expect n live, found n &lt; expected, but n &gt; 0 TOO_MANY_DISPLAYS expect n live, found n&gt; expected NO_PERSISTENCE_FEATURE when some displays missing, assume no persistence VERSION_NOT_UPGRADED all displays are out of date VERSION_INCOMPLETE_UPGRADE some displays are out of date NO_MESSAGES_FROM_BUS no MQTT messages were received (including position) MISCONFIGURED_DISPLAYS all displays are misconfigured PARTLY_MISCONFIGURED_DISPLAYS some displays are misconfigured"},{"location":"insight/#examples","title":"Examples","text":""},{"location":"insight/#topic-structure","title":"Topic structure","text":"<pre><code>{operator}/ruter/{vehicleId}/pe/sla/displays/v1\n</code></pre>"},{"location":"insight/#example-1-vehicle-ok","title":"Example 1 - vehicle OK","text":"<pre><code>{\n  \"eventTimestamp\": \"2022-01-24T15:46:00Z\",\n  \"compliance\": \"OK\",\n  \"complianceFaults\": [],\n  \"journeyStatus\": \"ON_SERVICE_JOURNEY\",\n  \"totalDisplayCount\": 4,\n  \"expectedDisplayCount\": 4,\n  \"liveDisplayCount\": 4,\n  \"displays\": [\n    {\n      \"clientId\": \"d1d8b91d3a137x4c567a5c\",\n      \"displayId\": \"1\",\n      \"routeId\": \"RUT:Route:110-58\",\n      \"dpiVersion\": \"2022-01-17T12:17:31Z\",\n      \"mediaVersion\": \"2021-12-27T09:41:00Z\"\n    },\n    {\n      \"clientId\": \"f4d2205br6c8ai4d0eO910\",\n      \"displayId\": \"2\",\n      \"routeId\": \"RUT:Route:110-58\",\n      \"dpiVersion\": \"2022-01-17T12:17:31Z\",\n      \"mediaVersion\": \"2021-12-27T09:41:00Z\"\n    },\n    {\n      \"clientId\": \"7cbc2125l5c12E43049a94\",\n      \"displayId\": \"3\",\n      \"routeId\": \"RUT:Route:110-58\",\n      \"dpiVersion\": \"2022-01-17T12:17:31Z\",\n      \"mediaVersion\": \"2021-12-27T09:41:00Z\"\n    },\n    {\n      \"clientId\": \"9d2fc206ld7b8x42ebga04\",\n      \"displayId\": \"4\",\n      \"routeId\": \"RUT:Route:110-58\",\n      \"dpiVersion\": \"2022-01-17T12:17:31Z\",\n      \"mediaVersion\": \"2021-12-27T09:41:00Z\"\n    }\n  ]\n}\n</code></pre>"},{"location":"insight/#example-2-vehicle-fail","title":"Example 2 - vehicle FAIL","text":"<pre><code>{\n  \"eventTimestamp\": \"2022-01-24T16:12:00Z\",\n  \"compliance\": \"FAIL\",\n  \"complianceFaults\": [\n    \"NO_LIVE_DISPLAYS\"\n  ],\n  \"journeyStatus\": \"ON_SERVICE_JOURNEY\",\n  \"totalDisplayCount\": 3,\n  \"expectedDisplayCount\": 3,\n  \"liveDisplayCount\": 0,\n  \"displays\": []\n}\n</code></pre>"},{"location":"insight/#example-3-on-dead-run","title":"Example 3 - on dead-run","text":"<pre><code>{\n  \"eventTimestamp\": \"2022-01-24T16:02:00Z\",\n  \"compliance\": \"NOT_IN_SERVICE\",\n  \"complianceFaults\": [\n    \"NO_LIVE_DISPLAYS\"\n  ],\n  \"journeyStatus\": \"ON_DEAD_RUN\",\n  \"totalDisplayCount\": 4,\n  \"expectedDisplayCount\": 4,\n  \"liveDisplayCount\": 0,\n  \"displays\": []\n}\n</code></pre>"},{"location":"issue/","title":"Report an issue","text":""},{"location":"issue/#improvement-suggestions","title":"Improvement suggestions","text":"<p>At Ruter we greatly appreciate open discussions about our APIs. If you have any suggestions on how they could work better, please feel free to create a Github issue here: </p> <p>Issue tracking</p>"},{"location":"issue/#typos-incorrect-information","title":"Typos / incorrect information","text":"<p>In case you see any typos or incorrect information on these documentation pages, we would appreciate if you could let us  know, or even better submit a pull request! </p>"},{"location":"live-status/","title":"Vehicle Status - Live information","text":""},{"location":"live-status/#introduction","title":"Introduction","text":"<p>In an effort to make it easier for PTOs of having a overview of the current status of their vehicles,  Ruter has created a simple status page showing Live information of SLA requirements. </p> <p>Notice!</p> <p>This application is provided on a best-effort basis, meaning Ruter bears no responsibility for any trouble the PTOs  may experience in case of service downtime or invalid information provided. </p> <p></p> <p>https://vehicle-status.transhub.io</p>"},{"location":"live-status/#data-source","title":"Data source","text":"<p>Notice!</p> <p>This application has been made to assist operators in identifying issues with their equipment. The original data source used here is the same as the one used by Ruter to calculate SLA for DPI displays.  However, this API is not intended for calculating SLA breaches.</p> <p>All data shown in the Vehicle Status page comes from the mqtt-topic described here: </p> <p>SLA Insight</p>"},{"location":"live-status/#authentication","title":"Authentication","text":"<p>When first visiting the page, you will be asked to enter MQTT: </p> <ul> <li>host</li> <li>username </li> <li>password</li> </ul> <p>On later visits, these are remembered in the browser. Take care not to leave any authentication credentials on public computers. </p> <p>It is recommended to use user accounts with READ-ONLY permissions, as the application is view only. </p>"},{"location":"mqtt/","title":"MQTT","text":"<p>MQTT is light-weight pub-sub messaging protocol often used for machine-to-machine (M2M)/\"Internet of Things\" communication. It is one of the standard communication protocols defined in ITxPT, and the way vehicles are supposed to communicate with Ruter.</p> <p>ITxPT</p> <p>MQTT is a fairly new addition to the ITxPT standard, and is currently a work in progress.  Ruter is an active member in the international standard committee.</p> <p>For more information, see:  - MQTT.org - ITxPT</p>"},{"location":"mqtt/#architecture","title":"Architecture","text":"<p>Two key elements of the architecture are the MQTT broker and the MQTT bridges. </p>"},{"location":"mqtt/#mqtt-broker-ruter","title":"MQTT broker (Ruter)","text":"<p>Ruter operates a central MQTT broker that communicates with all the vehicles. The server currently supports the MQTT protocol versions 5.0 and 3.1.1. </p> <p>Notice To use MQTT protocol version 5.0, make sure that the client library supports it.</p> <p>All communication with the MQTT broker is encrypted during transport using TLS 1.2. </p>"},{"location":"mqtt/#mqtt-bridge-on-board-vehicle","title":"MQTT bridge (On-board Vehicle)","text":"<p>The operator is to maintain a MQTT bridge on board the vehicle. The MQTT bridge acts as a proxy and forwards requests back and forth between the vehicle and Ruter. </p> <p>To get access to the MQTT broker, you need to reach out to Ruter to be provided with credentials. </p> <p>There is no strict requirement as to what implementation you chose of the mqtt bridge, as long as it is stable and fullfills the standard. </p> <p>There are multiple open-source solutions to choose from, i.e. https://mosquitto.org.  </p>"},{"location":"mqtt/#example-configuration-file-mosquitto","title":"Example configuration file (Mosquitto)","text":"<pre><code>port 1883\nlistener 9883\nprotocol websockets\nlog_type all\nlog_timestamp true\n\nconnection_messages true\nallow_anonymous true\n\n#\n# Ruter MQTT Bridge\n#\nconnection bus-to-authority-bridge\naddress mqtt.test.transhub.io:8883\nremote_username *****\nremote_password *****\nbridge_attempt_unsubscribe true\nbridge_protocol_version mqttv311\nbridge_tls_version tlsv1.2\nbridge_cafile /usr/local/etc/mosquitto/conf.d/amazon.ca.pem\nbridge_insecure false\ncleansession true\ntry_private true\nstart_type automatic\nrestart_timeout 10\n\n# Subscribe for these topics\n# topic type in/out qos shortroute longroute\ntopic json in 1 infohub/dpi/journey/ OPERATOR_ID/ruter/VEHICLE_ID/itxpt/ota/dpi/journey/\ntopic json in 1 infohub/dpi/externaldisplay/ OPERATOR_ID/ruter/VEHICLE_ID/itxpt/ota/dpi/externaldisplay/\ntopic json in 1 infohub/dpi/nextstop/ OPERATOR_ID/ruter/VEHICLE_ID/itxpt/ota/dpi/nextstop/\ntopic json in 1 infohub/dpi/eta/ OPERATOR_ID/ruter/VEHICLE_ID/itxpt/ota/dpi/eta/\ntopic json in 1 infohub/dpi/announcement/ OPERATOR_ID/ruter/VEHICLE_ID/itxpt/ota/dpi/announcement/\ntopic json in 1 infohub/dpi/deviation/ OPERATOR_ID/ruter/VEHICLE_ID/itxpt/ota/dpi/deviation/\ntopic json in 1 infohub/dpi/audio/ OPERATOR_ID/ruter/VEHICLE_ID/itxpt/ota/dpi/audio/\ntopic json in 1 infohub/dpi/arriving/ OPERATOR_ID/ruter/VEHICLE_ID/itxpt/ota/dpi/arriving/\ntopic json in 1 infohub/dpi/c2/ OPERATOR_ID/ruter/VEHICLE_ID/itxpt/ota/dpi/c2/\ntopic json out 1 infohub/dpi/diagnostics/ ruter/OPERATOR_ID/VEHICLE_ID/itxpt/ota/dpi/diagnostics/\n</code></pre>"},{"location":"mqtt/#updating-configurations-and-dpi-content","title":"Updating configurations and DPI content","text":"<p>Ruter reserves the right to update the topic configuration and content packages when it deems it necessary. </p> <p>While the PTO is responsible for setting up the mqtt bridge configuration correctly according to the software running on the vehicle, Ruter provides an api listing all the topics that should be made available for the services on-board the vehicle. </p> <p>A description of the process can be found in the document below:  - MQTT topic updates</p>"},{"location":"packages/","title":"Packages","text":"<p>Ruter publishes a packages manifest that provides a list of packages that should be installed on vehicles at the following locations.</p> Environment URL Purpose Prod https://pto-api.transhub.io/packages.json All vehicles running regular routes Stage https://pto-api.stage.transhub.io/packages.json Test rigs, vehicles being tested before running regular routes <p>These locations should be checked once daily, at a minimum, after 16.00 CET, which is our cutoff for changes for the day, Monday to Friday.</p> <p>It is expected that new packages should be installed on all vehicles running in regular traffic after 05.00 CET the following day.</p>"},{"location":"packages/#contents-of-manifest","title":"Contents of Manifest","text":"<pre><code>{\n\"timestamp\" : \"2021-02-25T14:43:14Z\",\n\"packages\" : [ {\n\"destination\" : \"application\",\n\"url\" : \"https://bus-dpi.transhub.io/packages/application-2021-02-25T14-25-12Z.zip\",\n\"sha256\" : \"5258f1e757ab9fb1e222601c793030219b7064b21206d234fc094bbdaf546fd0\"\n}, {\n\"destination\" : \"application/media\",\n\"url\" : \"https://bus-dpi.transhub.io/packages/media-2019-10-16T15-11-00Z.zip\",\n\"sha256\" : \"44a143c13ab452b7bd5d06f4ce3373af7b5a4da0095b42a3db27bd04e172072b\"\n} ]\n}\n</code></pre> <p>When a new version of the packages is published the timestamp will increment.</p> <p>Use the URL to fetch the packages and check that the downloaded Zip file has the same SHA256 values as in the manifest.</p>"},{"location":"packages/#placement-of-files","title":"Placement of Files","text":"<p>Currently the two zip files are organized internally slightly differently, and this affects how they need to be handled. The destination in the manifest refers to where the working directory must be when the file is unzipped.</p> <p>In addition, the destination \"application\" should be thought of a location chosen by the operator, which we can call $APPLICATION_ROOT.</p> <p>The packages should end up deployed in a structure like this:</p> <ul> <li>$APPLICATION_ROOT</li> <li>app</li> <li>media</li> <li>resources</li> </ul> <p>The directory application can actually be anything as long as it is the root of the web site that is served.</p> <p>Manually setting up this structure would be done with the following steps (verified in an Alpine container in Docker):</p> <p><pre><code>~ # apk add curl tree\n~ # curl -O https://bus-dpi.transhub.io/packages/application-2021-02-25T14-25-12Z.zip\n~ # curl -O https://bus-dpi.transhub.io/packages/media-2019-10-16T15-11-00Z.zip\n~ # sha256sum application-2021-02-25T14-25-12Z.zip media-2019-10-16T15-11-00Z.zip\n5258f1e757ab9fb1e222601c793030219b7064b21206d234fc094bbdaf546fd0  application-2021-02-25T14-25-12Z.zip\n44a143c13ab452b7bd5d06f4ce3373af7b5a4da0095b42a3db27bd04e172072b  media-2019-10-16T15-11-00Z.zip\n~ # mkdir -P /var/www/application &amp;&amp; cd /var/www/application\n/var/www/application # unzip ~/application-2021-02-25T14-25-12Z.zip\n/var/www/application # mkdir media &amp;&amp; cd media\n/var/www/application/media # unzip ~/media-2019-10-16T15-11-00Z.zip\n/var/www/application/media # cd ..\n/var/www/application # mkdir resources &amp;&amp; cd resources\n/var/www/application/resources # curl -O https://pto-api.test.transhub.io/resources/stop-requested-2020-11-02T15-02-50Z.mp3\n/var/www/application/resources # curl -O https://pto-api.test.transhub.io/resources/safety_long.opus\n/var/www/application/resources # cd ..\n/var/www/application # tree\n..\n\u251c\u2500\u2500 app\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 04889d2190d60b7f58a067bc5b3a0a99.woff2\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 1087eb494954e58ec8f09de436610b14.woff2\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 1e38058be4260221196853453c75c794.woff2\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 3e96977e3611f5114b5141ff066fb067.woff2\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 9ff5d1282d1cd14560959772a68e721d.woff2\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 app.ded55e6e43e867840fc3.bundle.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 app.ded55e6e43e867840fc3.bundle.js.map\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 e0e8c1b4bcd0dd594ac08449f2dc19e6.woff2\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 favicon.ico\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 index.html\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 static\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 img\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 info1.png\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 ruter-logo.png\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 tram-map.png\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 vendor.ded55e6e43e867840fc3.bundle.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 vendor.ded55e6e43e867840fc3.bundle.js.map\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 vendor_app.ded55e6e43e867840fc3.bundle.js\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 vendor_app.ded55e6e43e867840fc3.bundle.js.map\n\u251c\u2500\u2500 media\n\u2502   \u251c\u2500\u2500 1080p_Ruter_Holdning_Glad.mp4\n\u2502   \u251c\u2500\u2500 1080p_Toyen_K2.mp4\n\u2502   \u251c\u2500\u2500 480p_Ruter_Holdning_Glad.mp4\n\u2502   \u251c\u2500\u2500 480p_Toyen_K2.mp4\n\u2502   \u251c\u2500\u2500 720p_Ruter_Holdning_Glad.mp4\n\u2502   \u251c\u2500\u2500 720p_Toyen_K2.mp4\n\u2502   \u251c\u2500\u2500 campaign34.html\n\u2502   \u251c\u2500\u2500 manifest.js\n\u2502   \u251c\u2500\u2500 manifest.json\n\u2502   \u2514\u2500\u2500 ruter-sommerkampanje.mp4\n\u2514\u2500\u2500 resources\n    \u251c\u2500\u2500 stop-requested-2020-10-28T19-37-00Z.mp3\n    \u2514\u2500\u2500 safety_long.opus\n</code></pre> Automation should be based on these kinds of steps.</p>"},{"location":"packages/#web-server","title":"Web Server","text":"<p>Using nginx or some other proxy/webserver, point the root of the site to <code>/var/www/application</code> (or wherever $APPLICATION_ROOT points to).</p> <p>A very simple nginx configuration would be (for example by modifying /etc/nginx/conf.d/default.conf):</p> <pre><code>server {\n    listen 80 default_server;\n    listen [::]:80 default_server;\n\n    root /var/www/application;\n\n    location / {\n    }\n}\n</code></pre> <p>When a web server is set up, displays in a vehicle would point to the DPI application with a url like <code>http://webserver.local/app/index.html</code>.</p> <p>See DPI Bus Monitor Screen Configuration documentation for more details about setting up displays with the correct content.</p>"},{"location":"resources/","title":"Resources Manifest","text":"<p>The resources manifest is means of describing which resources Ruter is sharing with operators.  Initially, the list will contain an audio file intended to be played when a stop is requested on board the vehicle. It allows us to change the sound over time and ensure a uniform aural  experience for passengers.</p> <p>This manifest should be used in a similar way as with the packages and mqtt manifests. The  manifest should be checked at least once a day, after 16:00, and if there is a new version of a resources, download and start using it. The intention  is similar to the DPI application and MQTT: they should be in use by the next day. </p>"},{"location":"resources/#locations","title":"Locations","text":"<p>The manifest will be available at the following URLs:</p> Environment URL test https://pto-api.test.transhub.io/resources.json stage https://pto-api.stage.transhub.io/resources.json prod https://pto-api.transhub.io/resources.json"},{"location":"resources/#resources-provided","title":"Resources Provided","text":"<p>This list will be updated over time, as new resources are included. The Name in the table below  corresponds to the name in the resource item in the JSON, which is illustrated in an example later on, and in the field documentation for the Resource type.</p> Name Type Description Formats stopRequestedSound audio the sound that should be played when a passenger presses the stop button either mp3 or opus files"},{"location":"resources/#example","title":"Example","text":"<p>An example of the contents of the maifest looks like:</p> <pre><code>{\n  \"timestamp\": \"2020-10-28T20:41:23Z\",\n  \"environment\": \"prod\",\n  \"resources\": [ \n    {\n      \"name\": \"stopRequestedSound\",\n      \"type\": \"audio\",\n      \"contentType\": \"audio/mpeg\",\n      \"url\" : \"https://bus-dpi.transhub.io/resources/stop-requested-2020-10-28T19-37-00Z.mp3\",\n      \"sha256\" : \"f11de09c99b36f6097355c560d219716fc66857475f248b5196382830d5ba06a\",\n      \"version\" : \"2020-10-28T19:37:00Z\",\n      \"description\": \"bell3_stereo_256\"\n    }\n  ]\n}\n</code></pre>"},{"location":"resources/#fields","title":"Fields","text":""},{"location":"resources/#root","title":"Root","text":"Name Values Description timestamp ISO date/time stamp Time the new manifest is released environment test/stage/prod Which environment the manifest applies to resources list of type Resource a collection of one or more resources that Ruter shares"},{"location":"resources/#resource","title":"Resource","text":"Name Values Description name string names that Ruter defines, only \"stopRequestedSound\" is currently defined type string types that Ruter supports, only \"audio\" is currently defined contentType MIME type a MIME type that corresponds to the type of the resource that is shared url URL the location of where the resource can be fetched, the file name has a time stamp part that corresponds to its version sha256 string A SHA 256 hash of the resource, which can be used to verify the validity of the downloaded file version string a version date in ISO date/time format description string description of the content of the resource, e.g. the original file name of the resource; the field is optional"},{"location":"resources/#schema-and-example","title":"Schema and Example","text":"<p>A schema is available at: https://github.com/RuterNo/ota-schemas/blob/master/schemas/cdn/dpi-resources-manifest.json.</p> <p>A corresponding example is provided here: https://github.com/RuterNo/ota-schemas/blob/master/examples/cdn/resources.json.</p>"},{"location":"screen-configs/","title":"DPI Bus Monitor Screen Configuration","text":"<p>DPI Bus-monitor supports a range of pre-defined display types depending on size of the screen, screen location and functional needs. These screens are accessible directly through a URL with following schema: <code>{BaseURL}/app/#display/{type}</code>, eg. <code>http://webserver.local/app/#display/1</code>.</p>"},{"location":"screen-configs/#overview-of-screen-types","title":"Overview of screen types","text":"Id Content Aspect ratio Optimal screen resolution (width x height) Vehicle type 1 Vertical journey, Public Announcement 32:9 1920x540 Bus 2 Horizontal journey 48:9 1920x360 Bus 3 Vertical journey 16:9 1920x1080, 960x540 Bus 4 Vertical journey / Public Announcement 16:9 1920x1080, 960x540 Bus 5 Horizontal journey 32:9 1920x540 Bus t2-left Horizontal journey 1920:197 1920x197 Tram (SL18) t2-right Horizontal journey (reverse) 1920:197 1920x197 Tram (SL18) t3 Next stop / destination 128:9 1920x285 Tram (SL18) b1 Vertical journey 16:9 1920x1080 Ferry (Boreal) b2 Next stop, sensors / Public Announcement 16:9 1920x1080 Ferry (Boreal) <p>* These are approx. values and subject to change.</p>"},{"location":"screen-configs/#distribution-channels","title":"Distribution channels","text":"<p>Additionally, for public announcements, it is possible to target specific screens by which channels they subscribe to. You define which channels to subscribe to in the URL with following schema: <code>{BaseURL}/app/#display/{type}?channels=channel_name[filter_key}=filter_value,additional_channel_name</code>.</p>"},{"location":"screen-configs/#short-platform","title":"Short platform","text":"<ul> <li>t2-left: <code>{BaseURL}/app/#display/t2-left?channels=short_platform[active_cab]=c1</code></li> <li>t2-right: <code>{BaseURL}/app/#display/t2-right?channels=short_platform[active_cab]=c1</code></li> </ul> <p>Keep in mind that the keys and values are case-sensitive.</p> <p>Supported filters are:</p> Key Possible values active_cab c1, c2, inactive"},{"location":"screen-configs/#screen-configurations-for-bus-taas-vehicles","title":"Screen configurations for bus (TaaS vehicles)","text":""},{"location":"screen-configs/#screen-config-1","title":"Screen config 1","text":"<p>Running state of config 1, displaying journey (50% of the width) and additional information (fallback, when no public announcements* are showing).</p> <p>This is the default configuration used for 32:9, and most 32:9 screens should be configured to use this configuration.</p> <p></p> <p>Config 1 showing an example of public announcement.</p> <p>*The public announcements are either html campaigns, texts, video and images.</p>"},{"location":"screen-configs/#screen-config-2","title":"Screen config 2","text":"<p>Running state of config 2. This is the only configuration used for 48:9, and all 48:9 screens must be configured to use this configuration.</p>"},{"location":"screen-configs/#screen-config-3","title":"Screen config 3","text":"<p>Running state of config 3. Intended for screens dedicated to showing journey, i.e. no public announcements will be displayed on this screen.</p>"},{"location":"screen-configs/#screen-config-4","title":"Screen config 4","text":"<p>Running state of config 4. Default state for config 4 is showing journey.</p> <p></p> <p>Active public announcements will replace journey.</p>"},{"location":"screen-configs/#screen-config-5","title":"Screen config 5","text":"<p>This configuration is used to display a horizontal view of the line, on a 32:9 display.</p> <p>Draft!</p> <p>The visualization below is prone to change. This is not the finished product.</p> <p></p>"},{"location":"screen-configs/#assignment-of-screen-config-id-for-screens","title":"Assignment of screen config id for screens","text":"<p>General rule of thumb for assignment of configuration id:</p> <ol> <li>All 32:9 (1920x540) screens should usually be assigned config 1</li> <li>All 48:9 (1920x360) screen should always be assigned config 2</li> <li>All 16:9 (1920x1080 or 960x540) should always be assigned config 3, if any of these conditions are met:<ol> <li>This is the only screen on board</li> <li>This screen is in front of the bus</li> </ol> </li> <li>Screen config 4 is used for the right screen when 2x 16:9 screens are horizontally aligned, facing the same way (cf. example 1). (For all other 16:9 screens, use config 3)</li> <li>Screen config 5 is used for the 32:9 screens are vertically aligned. (For all other 32:9 screens, use config 1)</li> </ol> <p></p>"},{"location":"screen-configs/#screen-configurations-for-tram-sl18","title":"Screen configurations for tram (SL18)","text":""},{"location":"screen-configs/#screen-config-t2-left","title":"Screen config t2-left","text":"<p>Left side of the tram when active cab is c1.</p> <p></p> <p>Running state of t2-left. This is the only state (cf. troubleshooting for this config.</p>"},{"location":"screen-configs/#screen-config-t2-right","title":"Screen config t2-right","text":"<p>Right side of the tram when active cab is c1.</p> <p></p> <p>Running state of t2-left. This is the only state (cf. troubleshooting for this config.</p>"},{"location":"screen-configs/#screen-config-t3","title":"Screen config t3","text":""},{"location":"screen-configs/#state-1-doors-unlocked","title":"State 1 - doors unlocked","text":""},{"location":"screen-configs/#state-2-next-stop-produced","title":"State 2 - next stop produced","text":""},{"location":"screen-configs/#state-3-next-stop-produced-with-active-stop-signal","title":"State 3 - next stop produced with active stop signal","text":""},{"location":"screen-configs/#screen-configurations-for-ferry-boreal","title":"Screen configurations for ferry (Boreal)","text":""},{"location":"screen-configs/#screen-config-b1","title":"Screen config b1","text":"<p>Running state of config b1. Intended for screens dedicated to showing journey, i.e. public announcements (such as safety instructions etc) are ignored. This should be used for on the left screen in pair with config b2.</p> <p></p>"},{"location":"screen-configs/#screen-config-b2","title":"Screen config b2","text":"<p>Running state of config b1. Intended for screens dedicated to showing journey, i.e. public announcements (such as safety instructions etc) are ignored. This should be used for on the left screen in pair with config b2.</p> <p></p> <p></p> <p>Secondary information, intended for displaying safety announcements, deviations and other media content types. When there is no active media content playing, the screen will show information about next stop, destination and sensor information from the ferry as fallback. The sensor data is derived from following topics:</p> <ul> <li>telemetry/01001016 - water temperature</li> <li>telemetry/01001011 - temperature outside (ambient)</li> <li>weather - wind data</li> </ul>"},{"location":"timestamps/","title":"Standard for date and timestamps in ADT","text":"<p>This page specifies date and time standards between Ruter and PTO's.</p> <p>The date and time standards are based on the intersection of RFC 3339 and ISO 8601-1:2019.</p> <p>Each schema may specify how a timestamp property should be constructed. That will have precedence over what is specified in this document.</p>"},{"location":"timestamps/#time","title":"Time","text":"<ul> <li><code>T</code> should be used as a separator between date and timestamp</li> <li>Timestamp can be specified in both UTZ and local time. And timezone should always be specified<ul> <li><code>Z</code> for UTC</li> <li><code>+01:00</code> for local winter time</li> <li><code>+02:00</code> for local summer time</li> </ul> </li> </ul>"},{"location":"timestamps/#event-timestamp","title":"Event timestamp","text":"<p>If nothing else is specified and the schema specifies that the property is a <code>eventTimestamp</code>, the following rules apply.</p> <ul> <li>The <code>eventTimestamp</code> should have a minimum precision of milliseconds or higher e.g. nanoseconds.</li> </ul>"},{"location":"timestamps/#examples-date-and-time","title":"Examples date and time","text":"Description Example Date with year, month, and day <code>2023-04-21</code> Time with hours, minutes, and seconds <code>12:42:15Z</code> Time with hours, minutes, seconds, and fractional seconds (up to 9 digits) <code>12:43:12.631917Z</code> Date and time in UTC timezone with hours, minutes, and seconds <code>2023-04-21T12:42:15Z</code> Date and time in UTC timezone with hours, minutes, seconds, and fractional seconds <code>2023-04-21T12:43:12.631917Z</code> Date and time with hours, minutes, seconds, and timezone offset <code>2023-04-21T13:44:11.718742+01:00</code> Date and time with hours, minutes, seconds, and fractional seconds, and timezone offset <code>2023-04-21T13:44:11.718742+02:00</code> Date and time with hours, minutes, and seconds, and timezone offset from UTC <code>2023-04-21T13:44:11Z</code>"},{"location":"traffic-plan/","title":"Traffic plan export API","text":"<p>The API is used for syncing traffic plans between operators and Ruter. Operators can either use the exported traffic  plans directly for sign-on or compare their own traffic plans against the exported plans in order to find differences  that may lead to sign-on failing. </p> <p>comparing traffic plans</p> <p>The following script may be used as aid for comparing plans:  compare-traffic-plan</p>"},{"location":"traffic-plan/#about-the-exports","title":"About the exports","text":"<p>The traffic plans are exported in NeTEx format. Each export-file contains plans related to one contract within a time  period of 14 days. Each week new exports are generated and made available in the API. The exports have a version number  to differentiate between exports for the same contract.</p>"},{"location":"traffic-plan/#resources","title":"Resources","text":"<p>API Documentation</p>"},{"location":"troubleshooting-client/","title":"Troubleshooting client","text":""},{"location":"troubleshooting-client/#known-situations-and-client-fallbacks","title":"Known situations and client fallbacks","text":"<p>Listed below are situations that may occur and how these situations are indicated in busmonitor application.</p>"},{"location":"troubleshooting-client/#unable-to-establish-connection-to-local-mqtt-bridge","title":"Unable to establish connection to local mqtt-bridge","text":"<p>Note the slightly blueish gray background color.</p> <p>This means the client is unable to connect to the <code>ws://mqtt-broker:9883/mqtt</code> endpoint.</p>"},{"location":"troubleshooting-client/#checklist","title":"Checklist:","text":"<ol> <li>Make sure the host <code>mqtt-broker</code> is pointing to the ip address of the mqtt bridge in your host file (for Unix based systems: <code>/etc/hosts</code>)</li> <li>Make sure the mqtt-broker is running and allows anonymous connections. Authentication to the remote mqtt-broker is done in your mqtt-bridge config.</li> </ol>"},{"location":"troubleshooting-client/#no-journey-received","title":"No journey received","text":"<p>This means the client has established a connection to the mqtt-broker, but at the point of time has not received a journey. It may or have not received data on other topics. </p>"},{"location":"troubleshooting-client/#checklist_1","title":"Checklist:","text":"<ol> <li>Verify that the topics mappings in mqtt-bridge config are correct,      e.g. <code>topic json in 1 infohub/dpi/journey/ operator_name/ruter/vehicle_id/itxpt/ota/dpi/journey/</code></li> <li>Use a mqtt-client to subscribe to wildcard (<code>#</code>) in order to inspect incoming data and on which topics they are being sent.</li> </ol>"},{"location":"troubleshooting-client/#dead-run","title":"Dead run","text":"<p>The journey qualifies as a dead-run when the public code of the line equals <code>0</code>, route id is <code>RUT:Route:0</code>, or journey id includes a substring of <code>RUT:DeadRun:0</code>.</p> <p></p>"}]}